@page "/book/edit/{ItemId?}"

@using BusinessLibrary.BO.Book
@using Dal.Models
@using IPSTemplate.BusinessLibrary.BO.Author;
@using IPSTemplate.BusinessLibrary.BO.Genre;


@using IPSTemplate.UI.Blazor.Features.Author

@inherits EditView<TEBookBO, TEBook>

@if (ViewModel?.Model is null)
{
    <IPSLoader />
    return;
}

@if (Error is not null)
{
    @Error
    return;
}


<IPSForm Model=ViewModel OnSaved=@(() => ItemSaved.InvokeAsync()) >
    <FormFields>
        <IPSFormField Property=@ViewModel.GetProperty(() => ViewModel.Model.Name) />
        <IPSMultiSelect Property=@ViewModel.GetProperty(() => ViewModel.Model.AuthorIds) OnRead="GetAuthors"
                        TItem="TEAuthorInfo" TValue="Guid" TextField="ShowAs" ValueField="Id"
                        @ref=authorRef />
        <IPSButton Icon=Icon.Add Color="Color.Secondary" OnClick="(() => windowVisible = true)">Dodaj avtorja</IPSButton>
        
        <IPSRow>
            <IPSComboBox @ref=cbxGenre TItem=TEGenreInfo TValue=Guid?
                         TextField=@nameof(TEGenreInfo.Name)
                         ValueField=@nameof(TEGenreInfo.Id)
                         Property=@ViewModel.GetProperty(() => ViewModel.Model.GenreID)
                         OnRead="GetGenres" ColumnWidth="6" />
            <IPSComboBox Data=@TELanguages.OrderedUserFriendlyNameMap
                         ValueField=@nameof(KeyValuePair<string, string>.Key)
                         TextField=@nameof(KeyValuePair<string, string>.Value)
                         Property=@ViewModel.GetProperty(() => ViewModel.Model.Language) ColumnWidth="6" />
            
        </IPSRow>
        <IPSNumericTextBox Property=@ViewModel.GetProperty(() => ViewModel.Model.PageAmount) ColumnWidth="6" />
    </FormFields>
    <FormButtons>
        <IPSFormSaveButton />
    </FormButtons>
</IPSForm>

<IPSWindow Title="Dodaj novega avtorja"
           Size="WindowSize.Medium"
           ConfirmCloseWhen=@(() => _authorEditView.ViewModel.Model.IsDirty)
            @bind-Visible=@windowVisible>
    <WindowContent>
        <AuthorEdit ItemSaved=CloseEditView @ref=_authorEditView />
    </WindowContent>
</IPSWindow>





