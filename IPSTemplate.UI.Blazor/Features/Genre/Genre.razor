@page "/genre"
@using IPSTemplate.BusinessLibrary.BO.Genre;


<IPSPageTop Title="Žanre">
    <ActionsContent>
        <IPSButton IconClass="fas fa-plus" Color="Color.Primary" OnClick=@(() => OpenEditView(null))>Dodaj žanr</IPSButton>
    </ActionsContent>
</IPSPageTop>

<GenresGrid EditClicked=OpenEditView @ref=_grid />

<IPSWindow Title=@_editViewTitle
           Size="WindowSize.Small"
           ConfirmCloseWhen=@(() => _editView.ViewModel.Model.IsDirty)
@bind-Visible=@windowVisible>
    <WindowContent>
        <GenreEdit ItemId=@_selectedItemId ItemSaved=CloseEditView @ref=_editView />
    </WindowContent>
</IPSWindow>



@code{
    string? _selectedItemId;
    string? _editViewTitle;
    bool windowVisible;
    GenresGrid _grid = default!;
    GenreEdit _editView = default!;

    private GenreEdit _genreEdit = default!;

    //[Inject] NavigationManager NavigationManager { get; set; } = default!;

    protected void OpenEditView(TEGenreInfo? selectedItem)
    {
        if (selectedItem is null)
        {
            _editViewTitle = "Dodaj novi žanr";
            _selectedItemId = null;
        }
        else
        {
            _editViewTitle = $"Uredi žanr - {selectedItem.Name}";
            _selectedItemId = selectedItem.Id.ToString();
        }

        windowVisible = true;
    }

    async Task CloseEditView()
    {
        await Task.Delay(1000);
        windowVisible = false;
        _selectedItemId = null;
        _grid.Rebind();
    }

}